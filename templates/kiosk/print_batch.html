<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Print Name Tags</title>
  {% for font_href in google_font_hrefs %}
    <link rel="stylesheet" href="{{ font_href }}" />
  {% endfor %}
  <link rel="stylesheet" href="/static/css/print.css?v=20250205" />
</head>
<body class="print-body batch-print" style="font-family: {{ label_font_family }};">
  <div class="print-controls" {% if auto_print or iframe_mode %}style="display:none" aria-hidden="true"{% endif %}>
    <button class="btn btn-primary" type="button" id="print-now">Print now</button>
    <a class="btn btn-outline-secondary" href="/kiosk/">Back to kiosk</a>
  </div>
  {% for attendance in attendances %}
    <div class="tag tag-page{% if forloop.last %} tag-page-last{% endif %}">
      <div class="tag-first" data-name="{{ attendance.person.first_name }}" style="color: {{ first_name_color }};">{{ attendance.person.first_name|upper }}</div>
      {% if not hide_last_name %}
        <div class="tag-last" data-name="{{ attendance.person.last_name }}" style="color: {{ last_name_color }};">{{ attendance.person.last_name|upper }}</div>
      {% endif %}
    </div>
  {% endfor %}
  <script>
    (function () {
      const autoPrint = {{ auto_print|yesno:"true,false" }};
      const printButton = document.getElementById("print-now");
      if (autoPrint) {
        if (printButton) {
          printButton.closest(".print-controls").style.display = "none";
        }
        window.print();
      } else if (printButton) {
        printButton.addEventListener("click", () => window.print());
      }
      const firstNames = document.querySelectorAll(".tag-first");
      const lastNames = document.querySelectorAll(".tag-last");
      firstNames.forEach((nameEl) => {
        const text = nameEl.textContent || "";
        if (text.length > 14) {
          nameEl.classList.add("tiny");
        } else if (text.length > 10) {
          nameEl.classList.add("small");
        }
      });
      lastNames.forEach((nameEl) => {
        const text = nameEl.textContent || "";
        if (text.length > 12) {
          nameEl.classList.add("tiny");
        } else if (text.length > 9) {
          nameEl.classList.add("small");
        }
      });
    })();
    const iframeMode = {{ iframe_mode|yesno:"true,false" }};
    const returnToKiosk = () => {
      window.location.href = "/kiosk/";
    };
    const notifyParent = () => {
      if (iframeMode && window.parent) {
        window.parent.postMessage({ type: "kiosk-print-done" }, "*");
      }
    };
    window.addEventListener("afterprint", () => {
      if (iframeMode) {
        notifyParent();
        return;
      }
      if ({{ auto_print|yesno:"true,false" }}) {
        returnToKiosk();
      }
    });
    if (!iframeMode) {
      setTimeout(returnToKiosk, 5000);
    }
  </script>
</body>
</html>
