{% extends "admin/change_form.html" %}

{% block after_related_objects %}
  {{ block.super }}

  <div class="module">
    <h2>Attendees ({{ attendee_count }})</h2>
    {% if attendees %}
      <div class="results">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Check-in Time</th>
              <th>Family</th>
            </tr>
          </thead>
          <tbody>
            {% for attendance in attendees %}
              <tr>
                <td>{{ attendance.person.first_name }} {% if attendance.person.middle_initial %}{{ attendance.person.middle_initial }}.{% endif %} {{ attendance.person.last_name }}</td>
                <td>{{ attendance.checked_in_at|date:"M d, Y g:i A" }}</td>
                <td>{% if attendance.person.family %}{{ attendance.person.family.name }}{% else %}-{% endif %}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p>No attendees recorded yet.</p>
    {% endif %}
  </div>

  <div class="module">
    <h2>Missing Members ({{ missing_member_count }})</h2>
    {% if missing_members %}
      <div class="results">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Address</th>
              <th>City</th>
              <th>State/Province</th>
              <th>Postal Code</th>
              <th>Country</th>
            </tr>
          </thead>
          <tbody>
            {% for person in missing_members %}
              <tr>
                <td>{{ person.first_name }} {% if person.middle_initial %}{{ person.middle_initial }}.{% endif %} {{ person.last_name }}</td>
                <td>{{ person.phone }}</td>
                <td>{{ person.email }}</td>
                <td>{{ person.street_address }}</td>
                <td>{{ person.city }}</td>
                <td>{{ person.state_province }}</td>
                <td>{{ person.postal_code }}</td>
                <td>{{ person.country }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <p>
        <a class="button" href="/admin/missing-members/?format=csv">Export CSV</a>
      </p>
    {% else %}
      <p>All active members checked in for this service.</p>
    {% endif %}
  </div>

  <div class="module">
    <h2>First-Time Visitors ({{ first_time_visitor_count }})</h2>
    {% if first_time_visitors %}
      <div class="results">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Address</th>
              <th>City</th>
              <th>State/Province</th>
              <th>Postal Code</th>
              <th>Country</th>
            </tr>
          </thead>
          <tbody>
            {% for person in first_time_visitors %}
              <tr>
                <td>{{ person.first_name }} {% if person.middle_initial %}{{ person.middle_initial }}.{% endif %} {{ person.last_name }}</td>
                <td>{{ person.phone }}</td>
                <td>{{ person.email }}</td>
                <td>{{ person.street_address }}</td>
                <td>{{ person.city }}</td>
                <td>{{ person.state_province }}</td>
                <td>{{ person.postal_code }}</td>
                <td>{{ person.country }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p>No first-time visitors for this service.</p>
    {% endif %}
  </div>
{% endblock %}
